import{r as l,E as $,_ as N,n as u,A as mt,y as A,j as n,ba as Q,bu as vt,B as z,bp as Z,b5 as tt,bo as H,a$ as yt,bG as wt,bj as Ct,bH as I,bs as It,F as et,bh as xt,bI as bt,L,bl as St,bk as zt}from"./index.BpcIvL5C.js";import{g as Ft,F as V,C as Et,I as Ut,E as Ht,a as Tt,s as Bt,u as Dt,b as Lt}from"./FileHelper.B7wMHnJf.js";import{I as Rt}from"./InputInstructions.DABeMich.js";import{i as Mt}from"./inputUtils.CQWz5UKz.js";import{a as J}from"./index.C88pvD_q.js";import{U as ot}from"./UploadFileInfo.C-jY39rj.js";import{T as kt}from"./textarea.C9gOMijs.js";import"./base-input.BT0Fve4h.js";var nt=l.forwardRef(function(t,e){var r={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return l.createElement($,N({iconAttrs:r,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),l.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),l.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 015 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 005 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}))});nt.displayName="AttachFile";var at=l.forwardRef(function(t,e){var r={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return l.createElement($,N({iconAttrs:r,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),l.createElement("path",{d:"M11 15h2v2h-2v-2zm0-8h2v6h-2V7zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}))});at.displayName="ErrorOutline";var rt=l.forwardRef(function(t,e){var r={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return l.createElement($,N({iconAttrs:r,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),l.createElement("rect",{width:24,height:24,fill:"none"}),l.createElement("path",{d:"M3 5.51v3.71c0 .46.31.86.76.97L11 12l-7.24 1.81c-.45.11-.76.51-.76.97v3.71c0 .72.73 1.2 1.39.92l15.42-6.49c.82-.34.82-1.5 0-1.84L4.39 4.58C3.73 4.31 3 4.79 3 5.51z"}))});rt.displayName="Send";const Vt=u("div",{target:"e1togvvn0"})("border:none;position:relative;display:flex;"),$t=u("div",{target:"e1togvvn1"})(({theme:t,extended:e})=>({border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.widgetBorderColor??t.colors.transparent,borderRadius:t.radii.chatInput,backgroundColor:t.colors.secondaryBg,position:"relative",flexGrow:1,display:"flex",alignItems:"center",paddingLeft:t.spacing.lg,maxHeight:e?"none":t.sizes.minElementHeight,gap:t.spacing.sm,overflow:"hidden",":focus-within":{borderColor:t.colors.primary}})),Nt=u("button",{target:"e1togvvn2"})(({theme:t,disabled:e,extended:r})=>{const d=mt(t),[f,c]=d?[t.colors.gray60,t.colors.gray80]:[t.colors.gray80,t.colors.gray40];return{border:"none",backgroundColor:t.colors.transparent,borderTopRightRadius:r?"0":t.radii.chatInput,borderTopLeftRadius:r?t.radii.default:"0",borderBottomRightRadius:t.radii.chatInput,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:t.lineHeights.none,margin:t.spacing.none,padding:t.spacing.sm,color:e?f:c,pointerEvents:"auto","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{backgroundColor:d?t.colors.gray10:t.colors.gray90},"&:hover":{color:t.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{backgroundColor:t.colors.transparent,borderColor:t.colors.transparent,color:t.colors.gray,cursor:"not-allowed"}}}),At=u("div",{target:"e1togvvn3"})(({theme:t})=>({display:"flex",alignItems:"flex-end",height:"100%",position:"absolute",right:0,marginBottom:`-${t.sizes.borderWidth}`,pointerEvents:"none"})),Wt=u("div",{target:"e1togvvn4"})(({theme:t})=>({position:"absolute",bottom:"0px",right:`calc(${t.iconSizes.xl} + 2 * ${t.spacing.sm} + ${t.spacing.sm})`})),qt=u("div",{target:"ewqvugz0"})(({theme:t,height:e})=>({backgroundColor:t.colors.transparent,position:"absolute",left:0,bottom:0,minHeight:`max(${t.sizes.emptyDropdownHeight}, ${e})`,width:"100%",zIndex:t.zIndices.priority})),Pt=u("div",{target:"ewqvugz1"})(({theme:t,height:e})=>({border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.primary,borderRadius:t.radii.chatInput,backgroundColor:t.colors.secondaryBg,color:t.colors.primary,display:"flex",alignItems:"center",justifyContent:"center",height:e,width:"100%",fontWeight:t.fontWeights.bold})),Ot=u("div",{target:"ewqvugz2"})(({theme:t,disabled:e})=>({display:"flex",alignItems:"top",height:"100%",marginTop:`-${t.sizes.borderWidth}`,cursor:e?"not-allowed":"auto"})),Kt=u("div",{target:"ewqvugz3"})(({disabled:t})=>({pointerEvents:t?"none":"auto"})),_t=u("div",{target:"ewqvugz4"})(({theme:t})=>({marginTop:"0.625em",marginLeft:t.spacing.sm,height:t.spacing.xl,width:t.sizes.borderWidth,backgroundColor:t.colors.fadedText20})),Xt=u("div",{target:"ewqvugz5"})(({theme:t})=>({left:0,right:0,lineHeight:t.lineHeights.tight,paddingLeft:t.spacing.sm,paddingRight:t.spacing.sm,overflowX:"auto"})),Gt=u("div",{target:"ewqvugz6"})(({})=>({display:"flex"})),jt=u("div",{target:"ewqvugz7"})(({})=>({flex:"0 0 auto"})),Yt=u("div",{target:"ewqvugz8"})(({theme:t})=>({display:"flex",alignItems:"center",padding:t.spacing.sm,gap:t.spacing.twoXS})),Jt=u("div",{target:"ewqvugz9"})(({theme:t})=>({color:t.colors.fadedText60})),Qt=u("div",{target:"ewqvugz10"})(({theme:t,fileStatus:e})=>({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:e.type==="uploaded"?t.colors.bodyText:t.colors.fadedText60})),Zt=u("div",{target:"ewqvugz11"})(({theme:t})=>({marginRight:t.spacing.md,color:t.colors.fadedText60})),te=u("small",{target:"ewqvugz12"})(({theme:t})=>({display:"flex",alignItems:"center",maxHeight:t.sizes.smallElementHeight,color:t.colors.fadedText60,"& :hover":{color:t.colors.bodyText}}));function ee({children:t,content:e}){const r=A();return n(vt,{content:e,placement:Q.TOP,overrides:{Body:{style:{top:`-${r.sizes.minElementHeight}`}}},children:t})}const oe=({fileInfo:t})=>{const e=A(),{type:r}=t.status;switch(r){case"uploading":return n(wt,{usingCustomTheme:!1,"data-testid":"stChatInputFileIconSpinner",size:"lg",margin:"0",padding:"0"});case"error":return n(ee,{content:t.status.errorMessage,children:n(H,{color:e.colors.red,content:at,size:"lg"})});case"uploaded":return n(H,{content:Ut,size:"lg"});default:return yt(r),null}},ne=({fileInfo:t,onDelete:e})=>z(Yt,{className:"stChatInputFile","data-testid":"stChatInputFile",children:[n(Jt,{children:n(oe,{fileInfo:t})}),n(Qt,{className:"stChatInputFileName","data-testid":"stChatInputFileName",title:t.name,fileStatus:t.status,children:t.name}),n(Zt,{children:Ft(t.size,V.Byte)}),n(te,{"data-testid":"stChatInputDeleteBtn",children:n(Z,{onClick:()=>e(t.id),kind:tt.MINIMAL,children:n(H,{content:Et,size:"lg"})})})]}),ae=({items:t,onDelete:e})=>n(Xt,{"data-testid":"stChatUploadedFiles",children:n(Gt,{children:t.map(r=>n(jt,{children:n(ne,{fileInfo:r,onDelete:e})},r.id))})}),re=({getNextLocalFileId:t,addFiles:e,updateFile:r,uploadClient:d,element:f,onUploadProgress:c,onUploadComplete:m})=>(x,h)=>{const v=J.CancelToken.source(),g=new ot(h.name,h.size,t(),{type:"uploading",cancelToken:v,progress:1});e([g]),d.uploadFile({formId:"",...f},x.uploadUrl,h,p=>c(p,g.id),v.token).then(()=>m(g.id,x)).catch(p=>{J.isCancel(p)||r(g.id,g.setStatus({type:"error",errorMessage:p?p.toString():"Unknown error"}))})},ie=({acceptMultipleFiles:t,maxFileSize:e,uploadClient:r,uploadFile:d,addFiles:f,getNextLocalFileId:c,deleteExistingFiles:m,onUploadComplete:x})=>(h,v)=>{if(!t&&h.length===0&&v.length>1){const g=v.findIndex(p=>{var y;return((y=p.errors)==null?void 0:y[0].code)===Ht.TooManyFiles});g>=0&&(h.push(v[g].file),v.splice(g,1))}if(!t&&h.length>0&&m(),r.fetchFileURLs(h).then(g=>{Ct(g,h).forEach(([p,y])=>{d(p,y)})}).catch(g=>{f(h.map(p=>new ot(p.name,p.size,c(),{type:"error",errorMessage:g})))}),v.length>0){const g=v.map(p=>Tt(p,c(),e));f(g)}x()},se=({getRootProps:t,getInputProps:e,acceptFile:r,disabled:d,theme:f})=>z(Ot,{disabled:d,children:[z(Kt,{"data-testid":"stChatInputFileUploadButton",disabled:d,...t(),children:[n("input",{...e()}),n(It,{content:`Upload or drag and drop ${r===I.Multiple?"files":"a file"}`,placement:Q.TOP,onMouseEnterDelay:500,children:n(Z,{kind:tt.MINIMAL,disabled:d,children:n(H,{content:nt,size:"lg",color:d?f.colors.fadedText40:f.colors.fadedText60})})})]}),n(_t,{})]}),le=({getRootProps:t,getInputProps:e,acceptFile:r,inputHeight:d})=>z(et,{children:[n(qt,{height:d,...t(),children:n("input",{...e()})}),n(Pt,{height:d,children:`Drag and drop ${r===I.Multiple?"files":"a file"} here`})]}),de=6.5,R=1,M=(t,e,r)=>r.map(d=>d.id===t?e:d),k=(t,e)=>e.find(r=>r.id===t);function ce({disabled:t,element:e,widgetMgr:r,fragmentId:d,uploadClient:f}){const c=A(),m=l.useRef(null),x=l.useRef(0),h=l.useRef({minHeight:0,maxHeight:0}),{values:[v],elementRef:g}=xt(l.useMemo(()=>["width"],[])),[p,y]=l.useState(!1),[F,B]=l.useState(e.default),[E,W]=l.useState(0),[T,it]=l.useState(!1),[b,S]=l.useState([]),[U,D]=l.useState(!1),C=bt(e.acceptFile),q=Bt(e.maxUploadSizeMb,V.Megabyte,V.Byte),P=l.useCallback(o=>S(a=>[...a,...o]),[]),O=l.useCallback(o=>{S(a=>{const s=k(o,a);return L(s)?a:(s.status.type==="uploading"&&s.status.cancelToken.cancel(),s.status.type==="uploaded"&&s.status.fileUrls.deleteUrl&&f.deleteFile(s.status.fileUrls.deleteUrl),a.filter(i=>i.id!==o))})},[f]),st=()=>{const o=b.filter(a=>a.status.type==="uploaded").map(a=>{const{name:s,size:i,status:w}=a,{fileId:ht,fileUrls:ft}=w;return new St({fileId:ht,fileUrls:ft,name:s,size:i})});return new zt({uploadedFileInfo:o})},K=()=>x.current++,lt=ie({acceptMultipleFiles:C===I.Multiple,maxFileSize:q,uploadClient:f,uploadFile:re({getNextLocalFileId:K,addFiles:P,updateFile:(o,a)=>{S(s=>M(o,a,s))},uploadClient:f,element:e,onUploadProgress:(o,a)=>{S(s=>{const i=k(a,s);if(L(i)||i.status.type!=="uploading")return s;const w=Math.round(o.loaded*100/o.total);return i.status.progress===w?s:M(a,i.setStatus({type:"uploading",cancelToken:i.status.cancelToken,progress:w}),s)})},onUploadComplete:(o,a)=>{S(s=>{const i=k(o,s);return L(i)||i.status.type!=="uploading"?s:M(i.id,i.setStatus({type:"uploaded",fileId:a.fileId,fileUrls:a}),s)})}}),addFiles:P,getNextLocalFileId:K,deleteExistingFiles:()=>b.forEach(o=>O(o.id)),onUploadComplete:()=>{m.current&&m.current.focus()}}),{getRootProps:_,getInputProps:X}=Dt({onDrop:lt,multiple:C===I.Multiple,accept:Lt(e.fileType),maxSize:q}),dt=()=>{let o=0;const{current:a}=m;if(a){const s=a.placeholder;a.placeholder="",a.style.height="auto",o=a.scrollHeight,a.placeholder=s,a.style.height=""}return o},G=()=>{if(m.current&&m.current.focus(),!p||t)return;const o={data:F,fileUploaderState:st()};r.setChatInputValue(e,o,{fromUi:!0},d),y(!1),S([]),B(""),W(0)},ct=o=>{const{metaKey:a,ctrlKey:s,shiftKey:i}=o;Mt(o)&&!i&&!s&&!a&&(o.preventDefault(),G())},pt=o=>{const{value:a}=o.target,{maxChars:s}=e;s!==0&&a.length>s||(B(a),W(dt()))};l.useEffect(()=>b.some(o=>o.status.type==="uploading")?y(!1):y(F!==""||b.length>0),[b,F]),l.useEffect(()=>{if(e.setValue){e.setValue=!1;const o=e.value||"";B(o)}},[e]),l.useLayoutEffect(()=>{if(m.current){const{offsetHeight:o}=m.current;h.current.minHeight=o,h.current.maxHeight=o*de}},[m]),l.useEffect(()=>{const o=i=>{var w;i.preventDefault(),i.stopPropagation(),!U&&((w=i.dataTransfer)!=null&&w.types.includes("Files"))&&D(!0)},a=i=>{i.preventDefault(),i.stopPropagation(),U&&(i.clientX<=0&&i.clientY<=0||i.clientX>=window.innerWidth&&i.clientY>=window.innerHeight)&&D(!1)},s=i=>{i.preventDefault(),i.stopPropagation(),U&&D(!1)};return window.addEventListener("dragover",o),window.addEventListener("drop",s),window.addEventListener("dragleave",a),()=>{window.removeEventListener("dragover",o),window.removeEventListener("drop",s),window.removeEventListener("dragleave",a)}},[U]),l.useLayoutEffect(()=>{const{minHeight:o}=h.current;it(E>0&&m.current?Math.abs(E-o)>R:!1)},[E]);const{placeholder:j,maxChars:ut}=e,{maxHeight:Y}=h.current,gt=C!==I.None&&U;return z(et,{children:[C===I.None?null:n(ae,{items:[...b],onDelete:O}),n(Vt,{className:"stChatInput","data-testid":"stChatInput",ref:g,children:gt?n(le,{getRootProps:_,getInputProps:X,acceptFile:C,inputHeight:T?`${E+R}px`:c.sizes.minElementHeight}):z($t,{extended:T,children:[C===I.None?null:n(se,{getRootProps:_,getInputProps:X,acceptFile:C,disabled:t,theme:c}),n(kt,{inputRef:m,value:F,placeholder:j,onChange:pt,onKeyDown:ct,"aria-label":j,disabled:t,rows:1,overrides:{Root:{style:{minHeight:c.sizes.minElementHeight,outline:"none",borderLeftWidth:"0",borderRightWidth:"0",borderTopWidth:"0",borderBottomWidth:"0"}},Input:{props:{"data-testid":"stChatInputTextArea"},style:{lineHeight:c.lineHeights.inputWidget,"::placeholder":{opacity:"0.7"},height:T?`${E+R}px`:"auto",maxHeight:Y?`${Y}px`:"none",paddingLeft:c.spacing.none,paddingBottom:c.spacing.sm,paddingTop:c.spacing.sm,paddingRight:`calc(${c.iconSizes.xl} + 2 * ${c.spacing.sm} + ${c.spacing.sm})`}}}}),v>c.breakpoints.hideWidgetDetails&&n(Wt,{children:n(Rt,{dirty:p,value:F,maxLength:ut,type:"chat",inForm:!1})}),n(At,{children:n(Nt,{onClick:G,disabled:!p||t,extended:T,"data-testid":"stChatInputSubmitButton",children:n(H,{content:rt,size:"xl",color:"inherit"})})})]})})]})}const we=l.memo(ce);export{we as default};

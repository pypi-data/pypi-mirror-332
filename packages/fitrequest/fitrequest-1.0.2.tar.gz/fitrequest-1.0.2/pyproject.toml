[project]
name = "fitrequest"
version = "1.0.2"
description = "Python class that allow to create REST API client with dynamic code generation"
homepage = "https://skillcorner.com/"
repository = "https://gitlab.com/public-corner/fitrequest"
documentation = "https://fitrequest.readthedocs.io/en/latest/"
readme = "README.md"
requires-python = ">=3.10,<3.13"
dependencies = [
    "defusedxml>=0.7.1",
    "eval-type-backport>=0.2.0",
    "httpx>=0.28.1",
    "makefun>=1.15.4",
    "orjson>=3.9.10",
    "pydantic-settings>=2.6.1",
    "pydantic>=2.5.2",
    "jsonpath-ng>=1.7.0",
    "aiofiles>=24.1.0",
    "boto3>=1.34.96",
    "jinja2>=3.1.4",
    "tenacity>=9.0.0",
    "clustershell>=1.9.2",
    "typer>=0.15.1",
    "rich>=13.9.4",
]
# Remove of the eval-type-backport dependency when python 3.9 support is discontinued
# This will also allow to remove all: from __future__ import annotations


[build-system]
requires = ["hatchling"]
build-backend = "hatchling.build"

[tool.poe.tasks.doc]
help = "Build docs"
shell = "sphinx-build -M html ./docs/source/ ./build"

[tool.poe.tasks.test]
env = {base_cmd = "uv run pytest"}
help = "Simple command to perform tests."
control.expr = "debug_opt"

  [[tool.poe.tasks.test.args]]
  name = "tests"
  options = ["-t", "--tests"]
  help = "Path to test(s)"
  default = "tests"

  [[tool.poe.tasks.test.args]]
  name = "debug_opt"
  options = ["-d", "--debug"]
  help = "Enable detailed test output to display all print statements and allow the use of pdb breakpoints for debugging."
  type = "boolean"
  default = false

  [[tool.poe.tasks.test.switch]]
  case = "False"
  cmd = "$base_cmd $tests"

  [[tool.poe.tasks.test.switch]]
  case = "True"
  cmd = "$base_cmd -vv -rA -s --no-cov --pdbcls=IPython.terminal.debugger:Pdb $tests"

[tool.pytest.ini_options]
addopts = "--cov=fitrequest --cov-branch --cov-report term-missing --cov-report html --cov-report xml --cov-report lcov --junitxml=junit_test.xml"

[tool.ruff]
line-length = 120

[tool.ruff.lint]
fixable = ["ALL"]
select = ["ALL"]
ignore = [
  # Below are the rules defined to be ignored according to our company policy.
  "COM812", "D", "FA100", "FBT002", "INP001", "ISC001",

  "FBT001", # It's similar to FBT002, ignored.

  # * Rule:
  #     Checks for first-party, third-party, and standard library module imports that are used exclusively
  #     for type annotations but not defined within a type-checking block.
  # * Ignored because:
  #     To ensure types are available at runtime and avoid execution errors with Pydantic,
  #     import them directly without using an if TYPE_CHECKING: block.
  #     This avoids additional syntax and the need for "noqa" statements for certain types due to our use of Pydantic
  "TC001", "TC002", "TC003",

  # * Rule: Checks that *args, **kwargs arguments have type annotations.
  # * Ignored because: Cannot determine the types in advance as *args, **kwargs are used for arbitrary arguments.
  "ANN002", "ANN003",

  # * Rule: Checks that function arguments are annotated with a more specific type than Any.
  # * Ignored because: We sometimes just don't know the types involved.
  "ANN401",

  "PTH123",
  # * Rule: Checks for uses of the open() builtin.
  # * Ignored because: 'open' is builtin python method, I don't see why we should avoid it.
]


[tool.ruff.lint.flake8-quotes]
inline-quotes = "single"

[tool.ruff.format]
quote-style = "single"

[tool.ruff.lint.isort]
combine-as-imports = true
force-wrap-aliases = true

[tool.ruff.lint.per-file-ignores]
"**/{tests,docs}/*" = ["ALL"]

[dependency-groups]
dev = [
  "coverage>=7.6.1",
  "ipython>=8.12.3",
  "moto[secretsmanager, ssm]>=5.0.14",
  "poethepoet>=0.27.0",
  "pre-commit>=3.5.0",
  "pytest>=8.3.2",
  "respx>=0.22.0",
  "ruff>=0.6.2",
  "sphinx>=7.4.7",
  "sphinx-book-theme>=1.1.3",
  "pytest-cov>=5.0.0",
  "rich>=13.9.4",
  "autodoc-pydantic>=2.2.0",
  "sphinx-copybutton>=0.5.2",
  "sphinx-design>=0.6.1",
  "pytest-asyncio>=0.25.3",
]

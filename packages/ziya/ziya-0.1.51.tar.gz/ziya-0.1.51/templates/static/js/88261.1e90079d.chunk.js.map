{"version":3,"file":"static/js/88261.1e90079d.chunk.js","mappings":"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","sources":["../node_modules/@ant-design/icons-svg/es/asn/SaveOutlined.js","../node_modules/@ant-design/icons/es/icons/SaveOutlined.js","components/EditSection.tsx","../node_modules/@ant-design/icons-svg/es/asn/RedoOutlined.js","../node_modules/@ant-design/icons/es/icons/RedoOutlined.js","components/Conversation.tsx"],"sourcesContent":["// This icon file is generated automatically.\nvar SaveOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z\" } }] }, \"name\": \"save\", \"theme\": \"outlined\" };\nexport default SaveOutlined;\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\n\nimport * as React from 'react';\nimport SaveOutlinedSvg from \"@ant-design/icons-svg/es/asn/SaveOutlined\";\nimport AntdIcon from \"../components/AntdIcon\";\nvar SaveOutlined = function SaveOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _extends({}, props, {\n    ref: ref,\n    icon: SaveOutlinedSvg\n  }));\n};\n\n/**![save](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIGZpbGw9IiNjYWNhY2EiIHZpZXdCb3g9IjY0IDY0IDg5NiA4OTYiIGZvY3VzYWJsZT0iZmFsc2UiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTg5My4zIDI5My4zTDczMC43IDEzMC43Yy03LjUtNy41LTE2LjctMTMtMjYuNy0xNlYxMTJIMTQ0Yy0xNy43IDAtMzIgMTQuMy0zMiAzMnY3MzZjMCAxNy43IDE0LjMgMzIgMzIgMzJoNzM2YzE3LjcgMCAzMi0xNC4zIDMyLTMyVjMzOC41YzAtMTctNi43LTMzLjItMTguNy00NS4yek0zODQgMTg0aDI1NnYxMDRIMzg0VjE4NHptNDU2IDY1NkgxODRWMTg0aDEzNnYxMzZjMCAxNy43IDE0LjMgMzIgMzIgMzJoMzIwYzE3LjcgMCAzMi0xNC4zIDMyLTMyVjIwNS44bDEzNiAxMzZWODQwek01MTIgNDQyYy03OS41IDAtMTQ0IDY0LjUtMTQ0IDE0NHM2NC41IDE0NCAxNDQgMTQ0IDE0NC02NC41IDE0NC0xNDQtNjQuNS0xNDQtMTQ0LTE0NHptMCAyMjRjLTQ0LjIgMC04MC0zNS44LTgwLTgwczM1LjgtODAgODAtODAgODAgMzUuOCA4MCA4MC0zNS44IDgwLTgwIDgweiIgLz48L3N2Zz4=) */\nvar RefIcon = /*#__PURE__*/React.forwardRef(SaveOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'SaveOutlined';\n}\nexport default RefIcon;","import React, {useState} from \"react\";\nimport {useChatContext} from '../context/ChatContext';\nimport {sendPayload} from \"../apis/chatApi\";\nimport {Message} from \"../utils/types\";\nimport {useFolderContext} from \"../context/FolderContext\";\nimport {Button, Tooltip, Input, Space} from \"antd\";\nimport { convertKeysToStrings } from '../utils/types';\nimport {EditOutlined, CheckOutlined, CloseOutlined, SaveOutlined} from \"@ant-design/icons\";\n\ninterface EditSectionProps {\n    index: number;\n}\n\nexport const EditSection: React.FC<EditSectionProps> = ({index}) => {\n    const {\n        currentMessages,\n        currentConversationId,\n        addMessageToConversation,\n        setIsStreaming,\n\tsetConversations,\n        streamingConversations,\n\taddStreamingConversation,\n\tsetStreamedContentMap,\n\tremoveStreamingConversation\n    } = useChatContext();\n    \n    const [isEditing, setIsEditing] = useState(false);\n    const [editedMessage, setEditedMessage] = useState(currentMessages[index].content);\n    const {checkedKeys} = useFolderContext();\n    const {TextArea} = Input;\n\n    const handleEdit = () => {\n        setIsEditing(true);\n    };\n    \n    const handleSave = () => {\n        // Update the conversation in the context with the edited message\n        setConversations(prev => prev.map(conv => {\n            if (conv.id === currentConversationId) {\n                const updatedMessages = conv.messages.map((msg, i) => {\n                    if (i === index) {\n                        return {\n                            ...msg,\n                            content: editedMessage,\n                            _timestamp: Date.now()  // Update timestamp to mark as modified\n                        };\n                    }\n                    return msg;\n                });\n                return { ...conv, messages: updatedMessages, _version: Date.now() };\n            }\n            return conv;\n        }));\n        setIsEditing(false);\n    };\n\n    const handleCancel = () => {\n        setIsEditing(false);\n        setEditedMessage(currentMessages[index].content);\n    };\n\n    const handleSubmit = async () => {\n        setIsEditing(false);\n\n\t// Clear any existing streamed content\n        setStreamedContentMap(new Map());\n\n\t// Create truncated message array up to and including edited message\n        const truncatedMessages = currentMessages.slice(0, index + 1);\n\n        // Update the edited message\n        truncatedMessages[index] = {\n            ...truncatedMessages[index],\n            content: editedMessage,\n            _timestamp: Date.now()\n        };\n        // Set conversation to just the truncated messages\n        setConversations(prev => prev.map(conv =>\n            conv.id === currentConversationId\n                ? { ...conv, messages: truncatedMessages }\n                : conv\n        ));\n\n\taddStreamingConversation(currentConversationId);\n        try {\n            const result = await sendPayload(\n                currentConversationId,\n                editedMessage,\n\t\tstreamingConversations.has(currentConversationId),\n\t\tcurrentMessages,\n                setStreamedContentMap,\n                setIsStreaming,\n                convertKeysToStrings(checkedKeys),\n\t\taddMessageToConversation,\n\t\tremoveStreamingConversation\n            );\n\n            // Get the final streamed content\n            const finalContent = result;\n\n            if (finalContent) {\n                const newAIMessage: Message = {\n                    content: finalContent,\n                    role: 'assistant'\n                };\n                addMessageToConversation(newAIMessage, currentConversationId);\n            }\n        } catch (error) {\n            console.error('Error sending message:', error);\n            removeStreamingConversation(currentConversationId);\n      \t} finally {\n            setIsStreaming(false);\n        }\n    };\n\n    return (\n        <div>\n            {isEditing ? (\n                <>\n                    <TextArea\n                        style={{width: '38vw', height: '100px'}}\n                        value={editedMessage}\n                        onChange={(e) => setEditedMessage(e.target.value)}\n                    />\n                    <Space style={{ marginTop: '8px' }}>\n                        <Button icon={<CloseOutlined />} onClick={handleCancel} size=\"small\">\n                            Cancel\n                        </Button>\n                        <Button icon={<SaveOutlined />} onClick={handleSave} size=\"small\">\n                            Save\n                        </Button>\n                        <Button icon={<CheckOutlined />} onClick={handleSubmit} size=\"small\" type=\"primary\">\n                            Submit\n                        </Button>\n                    </Space>\n                </>\n            ) : (\n                <Tooltip title=\"Edit\">\n                    <Button icon={<EditOutlined/>} onClick={handleEdit}/>\n                </Tooltip>\n            )}\n        </div>\n    );\n}\n\n","// This icon file is generated automatically.\nvar RedoOutlined = { \"icon\": { \"tag\": \"svg\", \"attrs\": { \"viewBox\": \"64 64 896 896\", \"focusable\": \"false\" }, \"children\": [{ \"tag\": \"path\", \"attrs\": { \"d\": \"M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z\" } }] }, \"name\": \"redo\", \"theme\": \"outlined\" };\nexport default RedoOutlined;\n","import _extends from \"@babel/runtime/helpers/esm/extends\";\n// GENERATE BY ./scripts/generate.ts\n// DON NOT EDIT IT MANUALLY\n\nimport * as React from 'react';\nimport RedoOutlinedSvg from \"@ant-design/icons-svg/es/asn/RedoOutlined\";\nimport AntdIcon from \"../components/AntdIcon\";\nvar RedoOutlined = function RedoOutlined(props, ref) {\n  return /*#__PURE__*/React.createElement(AntdIcon, _extends({}, props, {\n    ref: ref,\n    icon: RedoOutlinedSvg\n  }));\n};\n\n/**![redo](data:image/svg+xml;base64,PHN2ZyB3aWR0aD0iNTAiIGhlaWdodD0iNTAiIGZpbGw9IiNjYWNhY2EiIHZpZXdCb3g9IjY0IDY0IDg5NiA4OTYiIGZvY3VzYWJsZT0iZmFsc2UiIHhtbG5zPSJodHRwOi8vd3d3LnczLm9yZy8yMDAwL3N2ZyI+PHBhdGggZD0iTTc1OC4yIDgzOS4xQzg1MS44IDc2NS45IDkxMiA2NTEuOSA5MTIgNTIzLjkgOTEyIDMwMyA3MzMuNSAxMjQuMyA1MTIuNiAxMjQgMjkxLjQgMTIzLjcgMTEyIDMwMi44IDExMiA1MjMuOWMwIDEyNS4yIDU3LjUgMjM2LjkgMTQ3LjYgMzEwLjIgMy41IDIuOCA4LjYgMi4yIDExLjQtMS4zbDM5LjQtNTAuNWMyLjctMy40IDIuMS04LjMtMS4yLTExLjEtOC4xLTYuNi0xNS45LTEzLjctMjMuNC0yMS4yYTMxOC42NCAzMTguNjQgMCAwMS02OC42LTEwMS43QzIwMC40IDYwOSAxOTIgNTY3LjEgMTkyIDUyMy45czguNC04NS4xIDI1LjEtMTI0LjVjMTYuMS0zOC4xIDM5LjItNzIuMyA2OC42LTEwMS43IDI5LjQtMjkuNCA2My42LTUyLjUgMTAxLjctNjguNkM0MjYuOSAyMTIuNCA0NjguOCAyMDQgNTEyIDIwNHM4NS4xIDguNCAxMjQuNSAyNS4xYzM4LjEgMTYuMSA3Mi4zIDM5LjIgMTAxLjcgNjguNiAyOS40IDI5LjQgNTIuNSA2My42IDY4LjYgMTAxLjcgMTYuNyAzOS40IDI1LjEgODEuMyAyNS4xIDEyNC41cy04LjQgODUuMS0yNS4xIDEyNC41YTMxOC42NCAzMTguNjQgMCAwMS02OC42IDEwMS43Yy05LjMgOS4zLTE5LjEgMTgtMjkuMyAyNkw2NjguMiA3MjRhOCA4IDAgMDAtMTQuMSAzbC0zOS42IDE2Mi4yYy0xLjIgNSAyLjYgOS45IDcuNyA5LjlsMTY3IC44YzYuNyAwIDEwLjUtNy43IDYuMy0xMi45bC0zNy4zLTQ3Ljl6IiAvPjwvc3ZnPg==) */\nvar RefIcon = /*#__PURE__*/React.forwardRef(RedoOutlined);\nif (process.env.NODE_ENV !== 'production') {\n  RefIcon.displayName = 'RedoOutlined';\n}\nexport default RefIcon;","import React, {useEffect, useRef, Suspense, memo} from \"react\";\nimport {useChatContext} from '../context/ChatContext';\nimport {EditSection} from \"./EditSection\";\nimport {Space, Spin, Button, Tooltip} from 'antd';\nimport {LoadingOutlined, RobotOutlined, RedoOutlined} from \"@ant-design/icons\";\nimport {sendPayload} from \"../apis/chatApi\";\nimport {useFolderContext} from \"../context/FolderContext\";\nimport {convertKeysToStrings} from \"../utils/types\";\n\n// Lazy load the MarkdownRenderer\nconst MarkdownRenderer = React.lazy(() => import(\"./MarkdownRenderer\"));\n\ninterface ConversationProps {\n    enableCodeApply: boolean;\n}\n\nconst Conversation: React.FC<ConversationProps> = memo(({ enableCodeApply }) => {\n    const {currentMessages, \n\t   isTopToBottom, \n\t   isLoadingConversation,\n\t   addStreamingConversation,\n\t   streamingConversations,\n           currentConversationId,\n\t   setIsStreaming,\n           setStreamedContentMap,\n           addMessageToConversation,\n           removeStreamingConversation\n    } = useChatContext();\n    \n    const {checkedKeys} = useFolderContext();\n    const visibilityRef = useRef<boolean>(true);\n    // Sort messages to maintain order\n    const displayMessages = isTopToBottom ? currentMessages : [...currentMessages].reverse();\n\n    // Keep track of rendered messages for performance monitoring\n    const renderedCountRef = useRef(0);\n\n    useEffect(() => {\n        console.debug('Conversation messages updated:', {\n            messageCount: currentMessages.length,\n            previousCount: renderedCountRef.current,\n            isVisible: visibilityRef.current,\n            displayOrder: isTopToBottom ? 'top-down' : 'bottom-up'\n        });\n\n        if (currentMessages.length !== renderedCountRef.current) {\n            renderedCountRef.current = currentMessages.length;\n            console.log(`Rendered ${currentMessages.length} messages`);\n        }\n\n        // Set up visibility observer\n        const observer = new IntersectionObserver(\n            (entries) => {\n                entries.forEach(entry => {\n                    visibilityRef.current = entry.isIntersecting;\n                    console.debug('Conversation visibility changed:', {\n                        isVisible: entry.isIntersecting,\n                        messageCount: currentMessages.length\n                    });\n                });\n            },\n            { threshold: 0.1 }\n        );\n\n        return () => observer.disconnect();\n    }, [currentMessages.length]);\n\n    // Loading indicator text based on progress\n    const loadingText = isLoadingConversation \n        ? currentMessages.length > 0\n            ? `Loading messages (${currentMessages.length} loaded)...`\n            : 'Loading conversation...'\n        : '';\n\n    // Progressive loading indicator\n    const showProgressiveLoading = isLoadingConversation && currentMessages.length > 0;\n\n    // Track whether we're in the initial loading state\n    const isInitialLoading = isLoadingConversation && currentMessages.length === 0;\n\n    // Function to determine if we need to show the retry button\n    const shouldShowRetry = (index: number) => {\n\tconst message = currentMessages[index];\n        const isLastMessage = index === currentMessages.length - 1;\n        const nextIndex = index + 1;\n        const nextMessage = nextIndex < currentMessages.length ? currentMessages[nextIndex] : null;\n        const hasNextMessage = nextIndex < currentMessages.length;\n\n        // Show retry if this is a human message and either:\n        // 1. It's the last message, or\n        // 2. The next message isn't from the assistant\n        return message?.role === 'human' &&\n               !streamingConversations.has(currentConversationId) &&\n               (isLastMessage || \n               (hasNextMessage && nextMessage?.role !== 'assistant'));\n    };\n\n    // Render retry button with explanation\n    const renderRetryButton = (index: number) => {\n        if (!shouldShowRetry(index)) return null;\n\n        return (\n            <Tooltip title=\"The AI response may have failed. Click to retry.\">\n                <Button\n                    icon={<RedoOutlined />}\n                    type=\"primary\"\n                    size=\"small\"\n\t\t    onClick={async () => {\n                        const message = currentMessages[index];\n\t\t\taddStreamingConversation(currentConversationId);\n\t\t\ttry {\n                            await sendPayload(\n                                currentConversationId,\n                                message.content,\n\t\t\t\tstreamingConversations.has(currentConversationId),\n                                currentMessages,\n                                setStreamedContentMap,\n                                setIsStreaming,\n                                convertKeysToStrings(checkedKeys),\n                                addMessageToConversation,\n                                removeStreamingConversation\n                            );\n                        } catch (error) {\n\t\t\t    removeStreamingConversation(currentConversationId);\n                            console.error('Error retrying message:', error);\n                        }\n                    }}\n                >\n                    Retry AI Response\n                </Button>\n            </Tooltip>\n        );\n    };\n    return (\n        <div style={{ position: 'relative' }}>\n            {isInitialLoading && (\n                <div style={{\n                    position: 'fixed',\n                    top: 'var(--header-height)',\n                    left: 'var(--folder-panel-width)',\n                    right: 0,\n                    bottom: 0,\n                    backgroundColor: 'rgba(0, 0, 0, 0.5)',\n                    display: 'flex',\n                    justifyContent: 'center',\n                    alignItems: 'center',\n                    zIndex: 1000\n                }}>\n                    <Spin size=\"large\" tip={loadingText} />\n                </div>\n            )}\n            <div \n                style={{ \n                    opacity: isLoadingConversation ? 0.5 : 1,\n                    minHeight: '50px' // Ensure visibility detection\n                }}\n                className=\"conversation-messages-container\"\n            >\n                {showProgressiveLoading && (\n                    <div style={{\n                        position: 'sticky',\n                        top: 0,\n                        backgroundColor: 'rgba(0, 0, 0, 0.7)',\n                        color: '#fff',\n                        padding: '8px 16px',\n                        borderRadius: '4px',\n                        margin: '8px 0',\n                        display: 'flex',\n                        alignItems: 'center',\n                        gap: '8px',\n                        zIndex: 1000\n                    }}>\n                        <Spin size=\"small\" />\n                        <span>{loadingText}</span>\n                    </div>\n                )}\n\t\t    {displayMessages.map((msg, index) => {\n                    const isLastMessage = index === displayMessages.length - 1;\n\t\t    // Convert display index to actual index for bottom-up mode\n                    const actualIndex = isTopToBottom ? index : currentMessages.length - 1 - index;\n                    const nextActualIndex = actualIndex + 1;\n                    const hasNextMessage = nextActualIndex < currentMessages.length;\n                    const nextMessage = hasNextMessage ? currentMessages[nextActualIndex] : null;\n                    const needsResponse = msg.role === 'human' &&\n                                        !streamingConversations.has(currentConversationId) &&\n\t\t\t\t\t(actualIndex === currentMessages.length - 1 ||\n                                         (hasNextMessage && nextMessage?.role !== 'assistant'));\n\n\t\t        return <div\n                            key={index}\n                            className={`message ${msg.role}${\n                                needsResponse\n                                    ? ' needs-response'\n                                    : ''\n                            }`}\n                        >\n                        {msg.role === 'human' ? (\n                            <div style={{display: 'flex', justifyContent: 'space-between'}}>\n                                <div className=\"message-sender\">You:</div>\n\t\t\t\t<div style={{ display: 'flex', gap: '8px' }}>\n                                    {needsResponse && renderRetryButton(actualIndex)}\n                                    <EditSection index={isTopToBottom ? index : currentMessages.length - 1 - index}/>\n                                </div>\n                            </div>\n                        ) : (\n                            <div style={{display: 'flex', justifyContent: 'space-between'}}>\n                                <div className=\"message-sender\">AI:</div>\n\t\t\t        {renderRetryButton(actualIndex)}\n                            </div>\n                        )}\n                        <div className=\"message-content\">\n                            <Suspense fallback={<div>Loading content...</div>}>\n                                <MarkdownRenderer \n                                    markdown={msg.content} \n                                    enableCodeApply={enableCodeApply}\n                                />\n                            </Suspense>\n                        </div>\n                    </div>;\n                })}\n            </div>\n        </div>\n    );\n}); \n\nexport default Conversation;\n"],"names":["SaveOutlined","props","ref","React","AntdIcon","_extends","icon","SaveOutlinedSvg","EditSection","_ref","index","currentMessages","currentConversationId","addMessageToConversation","setIsStreaming","setConversations","streamingConversations","addStreamingConversation","setStreamedContentMap","removeStreamingConversation","useChatContext","isEditing","setIsEditing","useState","editedMessage","setEditedMessage","content","checkedKeys","useFolderContext","TextArea","Input","_jsx","children","_jsxs","_Fragment","style","width","height","value","onChange","e","target","Space","marginTop","Button","CloseOutlined","onClick","handleCancel","size","handleSave","prev","map","conv","id","updatedMessages","messages","msg","i","_objectSpread","_timestamp","Date","now","_version","CheckOutlined","async","Map","truncatedMessages","slice","result","sendPayload","has","convertKeysToStrings","role","error","console","type","Tooltip","title","EditOutlined","handleEdit","RedoOutlined","RedoOutlinedSvg","MarkdownRenderer","memo","enableCodeApply","isTopToBottom","isLoadingConversation","visibilityRef","useRef","displayMessages","reverse","renderedCountRef","useEffect","debug","messageCount","length","previousCount","current","isVisible","displayOrder","log","concat","observer","IntersectionObserver","entries","forEach","entry","isIntersecting","threshold","disconnect","loadingText","showProgressiveLoading","isInitialLoading","renderRetryButton","message","isLastMessage","nextIndex","nextMessage","hasNextMessage","shouldShowRetry","position","top","left","right","bottom","backgroundColor","display","justifyContent","alignItems","zIndex","Spin","tip","opacity","minHeight","className","color","padding","borderRadius","margin","gap","actualIndex","nextActualIndex","needsResponse","Suspense","fallback","markdown"],"sourceRoot":""}
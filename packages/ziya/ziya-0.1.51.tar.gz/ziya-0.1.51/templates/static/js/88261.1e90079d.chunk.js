/*! For license information please see 88261.1e90079d.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunkfrontend=self.webpackChunkfrontend||[]).push([[88261],{88261:(e,n,s)=>{s.r(n),s.d(n,{default:()=>S});var t=s(65043),a=s(78626),r=s(89379),o=s(82137),i=s(36011),l=s(41982),c=s(6051),d=s(4015),g=s(97606),h=s(57721),m=s(53727),v=s(58168);const u={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M893.3 293.3L730.7 130.7c-7.5-7.5-16.7-13-26.7-16V112H144c-17.7 0-32 14.3-32 32v736c0 17.7 14.3 32 32 32h736c17.7 0 32-14.3 32-32V338.5c0-17-6.7-33.2-18.7-45.2zM384 184h256v104H384V184zm456 656H184V184h136v136c0 17.7 14.3 32 32 32h320c17.7 0 32-14.3 32-32V205.8l136 136V840zM512 442c-79.5 0-144 64.5-144 144s64.5 144 144 144 144-64.5 144-144-64.5-144-144-144zm0 224c-44.2 0-80-35.8-80-80s35.8-80 80-80 80 35.8 80 80-35.8 80-80 80z"}}]},name:"save",theme:"outlined"};var p=s(22172),x=function(e,n){return t.createElement(p.A,(0,v.A)({},e,{ref:n,icon:u}))};const y=t.forwardRef(x);var f=s(63390),C=s(67407),j=s(70579);const A=e=>{let{index:n}=e;const{currentMessages:s,currentConversationId:v,addMessageToConversation:u,setIsStreaming:p,setConversations:x,streamingConversations:A,addStreamingConversation:b,setStreamedContentMap:w,removeStreamingConversation:k}=(0,a.v)(),[z,I]=(0,t.useState)(!1),[S,M]=(0,t.useState)(s[n].content),{checkedKeys:R}=(0,i.X)(),{TextArea:V}=l.A;return(0,j.jsx)("div",{children:z?(0,j.jsxs)(j.Fragment,{children:[(0,j.jsx)(V,{style:{width:"38vw",height:"100px"},value:S,onChange:e=>M(e.target.value)}),(0,j.jsxs)(c.A,{style:{marginTop:"8px"},children:[(0,j.jsx)(d.Ay,{icon:(0,j.jsx)(m.A,{}),onClick:()=>{I(!1),M(s[n].content)},size:"small",children:"Cancel"}),(0,j.jsx)(d.Ay,{icon:(0,j.jsx)(y,{}),onClick:()=>{x((e=>e.map((e=>{if(e.id===v){const s=e.messages.map(((e,s)=>s===n?(0,r.A)((0,r.A)({},e),{},{content:S,_timestamp:Date.now()}):e));return(0,r.A)((0,r.A)({},e),{},{messages:s,_version:Date.now()})}return e})))),I(!1)},size:"small",children:"Save"}),(0,j.jsx)(d.Ay,{icon:(0,j.jsx)(f.A,{}),onClick:async()=>{I(!1),w(new Map);const e=s.slice(0,n+1);e[n]=(0,r.A)((0,r.A)({},e[n]),{},{content:S,_timestamp:Date.now()}),x((n=>n.map((n=>n.id===v?(0,r.A)((0,r.A)({},n),{},{messages:e}):n)))),b(v);try{const e=await(0,o.f)(v,S,A.has(v),s,w,p,(0,h.F)(R),u,k);if(e){u({content:e,role:"assistant"},v)}}catch(t){console.error("Error sending message:",t),k(v)}finally{p(!1)}},size:"small",type:"primary",children:"Submit"})]})]}):(0,j.jsx)(g.A,{title:"Edit",children:(0,j.jsx)(d.Ay,{icon:(0,j.jsx)(C.A,{}),onClick:()=>{I(!0)}})})})};var b=s(91686);const w={icon:{tag:"svg",attrs:{viewBox:"64 64 896 896",focusable:"false"},children:[{tag:"path",attrs:{d:"M758.2 839.1C851.8 765.9 912 651.9 912 523.9 912 303 733.5 124.3 512.6 124 291.4 123.7 112 302.8 112 523.9c0 125.2 57.5 236.9 147.6 310.2 3.5 2.8 8.6 2.2 11.4-1.3l39.4-50.5c2.7-3.4 2.1-8.3-1.2-11.1-8.1-6.6-15.9-13.7-23.4-21.2a318.64 318.64 0 01-68.6-101.7C200.4 609 192 567.1 192 523.9s8.4-85.1 25.1-124.5c16.1-38.1 39.2-72.3 68.6-101.7 29.4-29.4 63.6-52.5 101.7-68.6C426.9 212.4 468.8 204 512 204s85.1 8.4 124.5 25.1c38.1 16.1 72.3 39.2 101.7 68.6 29.4 29.4 52.5 63.6 68.6 101.7 16.7 39.4 25.1 81.3 25.1 124.5s-8.4 85.1-25.1 124.5a318.64 318.64 0 01-68.6 101.7c-9.3 9.3-19.1 18-29.3 26L668.2 724a8 8 0 00-14.1 3l-39.6 162.2c-1.2 5 2.6 9.9 7.7 9.9l167 .8c6.7 0 10.5-7.7 6.3-12.9l-37.3-47.9z"}}]},name:"redo",theme:"outlined"};var k=function(e,n){return t.createElement(p.A,(0,v.A)({},e,{ref:n,icon:w}))};const z=t.forwardRef(k),I=t.lazy((()=>Promise.all([s.e(53653),s.e(79218),s.e(96603),s.e(83953),s.e(46907),s.e(18884)]).then(s.bind(s,46907)))),S=(0,t.memo)((e=>{let{enableCodeApply:n}=e;const{currentMessages:s,isTopToBottom:r,isLoadingConversation:l,addStreamingConversation:c,streamingConversations:m,currentConversationId:v,setIsStreaming:u,setStreamedContentMap:p,addMessageToConversation:x,removeStreamingConversation:y}=(0,a.v)(),{checkedKeys:f}=(0,i.X)(),C=(0,t.useRef)(!0),w=r?s:[...s].reverse(),k=(0,t.useRef)(0);(0,t.useEffect)((()=>{console.debug("Conversation messages updated:",{messageCount:s.length,previousCount:k.current,isVisible:C.current,displayOrder:r?"top-down":"bottom-up"}),s.length!==k.current&&(k.current=s.length,console.log("Rendered ".concat(s.length," messages")));const e=new IntersectionObserver((e=>{e.forEach((e=>{C.current=e.isIntersecting,console.debug("Conversation visibility changed:",{isVisible:e.isIntersecting,messageCount:s.length})}))}),{threshold:.1});return()=>e.disconnect()}),[s.length]);const S=l?s.length>0?"Loading messages (".concat(s.length," loaded)..."):"Loading conversation...":"",M=l&&s.length>0,R=l&&0===s.length,V=e=>(e=>{const n=s[e],t=e===s.length-1,a=e+1,r=a<s.length?s[a]:null,o=a<s.length;return"human"===(null===n||void 0===n?void 0:n.role)&&!m.has(v)&&(t||o&&"assistant"!==(null===r||void 0===r?void 0:r.role))})(e)?(0,j.jsx)(g.A,{title:"The AI response may have failed. Click to retry.",children:(0,j.jsx)(d.Ay,{icon:(0,j.jsx)(z,{}),type:"primary",size:"small",onClick:async()=>{const n=s[e];c(v);try{await(0,o.f)(v,n.content,m.has(v),s,p,u,(0,h.F)(f),x,y)}catch(t){y(v),console.error("Error retrying message:",t)}},children:"Retry AI Response"})}):null;return(0,j.jsxs)("div",{style:{position:"relative"},children:[R&&(0,j.jsx)("div",{style:{position:"fixed",top:"var(--header-height)",left:"var(--folder-panel-width)",right:0,bottom:0,backgroundColor:"rgba(0, 0, 0, 0.5)",display:"flex",justifyContent:"center",alignItems:"center",zIndex:1e3},children:(0,j.jsx)(b.A,{size:"large",tip:S})}),(0,j.jsxs)("div",{style:{opacity:l?.5:1,minHeight:"50px"},className:"conversation-messages-container",children:[M&&(0,j.jsxs)("div",{style:{position:"sticky",top:0,backgroundColor:"rgba(0, 0, 0, 0.7)",color:"#fff",padding:"8px 16px",borderRadius:"4px",margin:"8px 0",display:"flex",alignItems:"center",gap:"8px",zIndex:1e3},children:[(0,j.jsx)(b.A,{size:"small"}),(0,j.jsx)("span",{children:S})]}),w.map(((e,a)=>{w.length;const o=r?a:s.length-1-a,i=o+1,l=i<s.length,c=l?s[i]:null,d="human"===e.role&&!m.has(v)&&(o===s.length-1||l&&"assistant"!==(null===c||void 0===c?void 0:c.role));return(0,j.jsxs)("div",{className:"message ".concat(e.role).concat(d?" needs-response":""),children:["human"===e.role?(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,j.jsx)("div",{className:"message-sender",children:"You:"}),(0,j.jsxs)("div",{style:{display:"flex",gap:"8px"},children:[d&&V(o),(0,j.jsx)(A,{index:r?a:s.length-1-a})]})]}):(0,j.jsxs)("div",{style:{display:"flex",justifyContent:"space-between"},children:[(0,j.jsx)("div",{className:"message-sender",children:"AI:"}),V(o)]}),(0,j.jsx)("div",{className:"message-content",children:(0,j.jsx)(t.Suspense,{fallback:(0,j.jsx)("div",{children:"Loading content..."}),children:(0,j.jsx)(I,{markdown:e.content,enableCodeApply:n})})})]},a)}))]})]})}))}}]);
//# sourceMappingURL=88261.1e90079d.chunk.js.map